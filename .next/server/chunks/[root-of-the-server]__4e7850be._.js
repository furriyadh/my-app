module.exports = {

"[project]/.next-internal/server/app/api/google-ads/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/string_decoder [external] (string_decoder, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/dns [external] (dns, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[project]/src/app/api/google-ads/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
// src/app/api/google-ads/route.ts
__turbopack_context__.s({
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
;
// @ts-ignore - Google Ads API doesn't have official TypeScript types
const { GoogleAdsApi } = __turbopack_context__.r("[project]/node_modules/google-ads-api/build/src/index.js [app-route] (ecmascript)");
// إنشاء Supabase client للخادم
const supabaseUrl = ("TURBOPACK compile-time value", "https://mkzwqbgcfdzcqmkgzwgy.supabase.co");
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey);
async function POST(request) {
    try {
        console.log('🚀 Next.js API Route: استدعاء Google Ads data مع Client Library...');
        const body = await request.json();
        const { loginCustomerId, startDate, endDate, dataType } = body;
        console.log('📥 Request body:', {
            loginCustomerId,
            startDate,
            endDate,
            dataType
        });
        // Get environment variables
        const refreshToken = process.env.GOOGLE_REFRESH_TOKEN;
        const clientId = process.env.GOOGLE_CLIENT_ID;
        const clientSecret = process.env.GOOGLE_CLIENT_SECRET;
        const developerId = process.env.GOOGLE_DEVELOPER_TOKEN;
        const mccCustomerId = process.env.MCC_LOGIN_CUSTOMER_ID;
        console.log('🔑 Environment check:', {
            hasRefreshToken: !!refreshToken,
            hasClientId: !!clientId,
            hasClientSecret: !!clientSecret,
            hasDeveloperToken: !!developerId,
            hasMccCustomerId: !!mccCustomerId
        });
        if (!refreshToken || !clientId || !clientSecret || !developerId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Missing required environment variables',
                details: {
                    hasRefreshToken: !!refreshToken,
                    hasClientId: !!clientId,
                    hasClientSecret: !!clientSecret,
                    hasDeveloperToken: !!developerId,
                    hasMccCustomerId: !!mccCustomerId
                }
            }, {
                status: 400
            });
        }
        // إنشاء Google Ads API client
        console.log('🔧 Creating Google Ads API client...');
        const client = new GoogleAdsApi({
            client_id: clientId,
            client_secret: clientSecret,
            developer_token: developerId
        });
        // Format customer ID (remove dashes)
        const formattedCustomerId = loginCustomerId?.replace(/-/g, '') || '3271710441';
        console.log('🎯 Using customer ID:', formattedCustomerId);
        // إنشاء customer instance
        console.log('👤 Creating customer instance...');
        const customer = client.Customer({
            customer_id: formattedCustomerId,
            refresh_token: refreshToken,
            login_customer_id: mccCustomerId?.replace(/-/g, '') || undefined
        });
        // تحديد التواريخ (آخر 7 أيام)
        const endDateFormatted = endDate || new Date().toISOString().split('T')[0];
        const startDateFormatted = startDate || new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        console.log('📅 Date range:', {
            startDateFormatted,
            endDateFormatted
        });
        // Google Ads API query المحدث
        const query = `
      SELECT 
        campaign.id,
        campaign.name,
        campaign.status,
        metrics.cost_micros,
        metrics.clicks,
        metrics.impressions,
        segments.date
      FROM campaign 
      WHERE campaign.status = 'ENABLED' 
        AND segments.date >= '${startDateFormatted}'
        AND segments.date <= '${endDateFormatted}'
    `;
        console.log('📡 Executing Google Ads query...');
        console.log('🔍 Query:', query.trim());
        // تنفيذ الاستعلام
        const results = await customer.query(query.trim());
        console.log('✅ Query executed successfully');
        console.log('📊 Results count:', results.length);
        // Transform data to match Frontend expectations
        const transformedData = results.map((row, index)=>{
            const campaign = row.campaign || {};
            const metrics = row.metrics || {};
            const segments = row.segments || {};
            return {
                id: campaign.id?.toString() || `campaign_${index}`,
                name: campaign.name || 'Unknown Campaign',
                status: campaign.status || 'UNKNOWN',
                cost: metrics.cost_micros ? (parseInt(metrics.cost_micros) / 1000000).toFixed(2) : '0.00',
                clicks: parseInt(metrics.clicks) || 0,
                impressions: parseInt(metrics.impressions) || 0,
                date: segments.date || 'unknown',
                // إضافة خصائص إضافية للتوافق مع Frontend
                type: 'campaign',
                platform: 'google_ads',
                currency: 'USD'
            };
        });
        // تجميع البيانات حسب الحملة (إذا كان هناك عدة أيام)
        const campaignSummary = transformedData.reduce((acc, row)=>{
            const campaignId = row.id;
            if (!acc[campaignId]) {
                acc[campaignId] = {
                    id: row.id,
                    name: row.name,
                    status: row.status,
                    cost: 0,
                    clicks: 0,
                    impressions: 0,
                    dates: [],
                    type: row.type,
                    platform: row.platform,
                    currency: row.currency
                };
            }
            acc[campaignId].cost += parseFloat(row.cost);
            acc[campaignId].clicks += parseInt(row.clicks);
            acc[campaignId].impressions += parseInt(row.impressions);
            acc[campaignId].dates.push(row.date);
            return acc;
        }, {});
        const finalData = Object.values(campaignSummary).map((campaign)=>({
                ...campaign,
                cost: campaign.cost.toFixed(2),
                // إضافة معلومات إضافية
                ctr: campaign.impressions > 0 ? (campaign.clicks / campaign.impressions * 100).toFixed(2) : '0.00',
                cpc: campaign.clicks > 0 ? (campaign.cost / campaign.clicks).toFixed(2) : '0.00',
                dateRange: `${startDateFormatted} to ${endDateFormatted}`
            }));
        console.log('🔄 Data transformed and summarized:', finalData);
        // Save data to Supabase Database with proper structure
        try {
            console.log('💾 Saving data to Supabase...');
            // إنشاء record واحد للحفظ
            const supabaseRecord = {
                customer_id: formattedCustomerId,
                campaigns_data: finalData,
                total_campaigns: finalData.length,
                total_cost: finalData.reduce((sum, campaign)=>sum + parseFloat(campaign.cost), 0).toFixed(2),
                total_clicks: finalData.reduce((sum, campaign)=>sum + campaign.clicks, 0),
                total_impressions: finalData.reduce((sum, campaign)=>sum + campaign.impressions, 0),
                date_range_start: startDateFormatted,
                date_range_end: endDateFormatted,
                fetched_at: new Date().toISOString(),
                data_type: dataType || 'campaigns'
            };
            const { error: saveError } = await supabase.from('google_ads_campaigns').upsert(supabaseRecord, {
                onConflict: 'customer_id,date_range_start,date_range_end'
            });
            if (saveError) {
                console.error('❌ Supabase save error:', saveError);
            } else {
                console.log('✅ Data saved to Supabase successfully');
            }
        } catch (saveError) {
            console.error('❌ Supabase save failed:', saveError);
        // Continue even if save fails
        }
        // إرجاع البيانات بالتنسيق المتوقع من Frontend
        const response = {
            success: true,
            data: finalData,
            summary: {
                totalCampaigns: finalData.length,
                totalCost: finalData.reduce((sum, campaign)=>sum + parseFloat(campaign.cost), 0).toFixed(2),
                totalClicks: finalData.reduce((sum, campaign)=>sum + campaign.clicks, 0),
                totalImpressions: finalData.reduce((sum, campaign)=>sum + campaign.impressions, 0),
                dateRange: `${startDateFormatted} to ${endDateFormatted}`
            },
            metadata: {
                query: query.trim(),
                customerId: formattedCustomerId,
                fetchedAt: new Date().toISOString(),
                source: 'google_ads_api'
            }
        };
        console.log('📤 Sending response:', response);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(response);
    } catch (error) {
        console.error('💥 خطأ في Google Ads API:', error);
        // تفصيل أكثر للأخطاء
        let errorMessage = error.message || 'Unknown error';
        let errorDetails = {};
        if (error.details) {
            errorDetails = error.details;
        }
        if (error.failure) {
            errorDetails = {
                ...errorDetails,
                failure: error.failure
            };
        }
        if (error.errors) {
            errorDetails = {
                ...errorDetails,
                errors: error.errors
            };
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Google Ads API error',
            message: errorMessage,
            details: errorDetails,
            timestamp: new Date().toISOString()
        }, {
            status: 500
        });
    }
}
async function GET(request) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        message: 'Google Ads API Route is working with Client Library. Use POST method to fetch data.',
        timestamp: new Date().toISOString(),
        library: 'google-ads-api',
        status: 'ready',
        endpoints: {
            campaigns: 'POST /api/google-ads with dataType: campaigns',
            keywords: 'POST /api/google-ads with dataType: keywords',
            ads: 'POST /api/google-ads with dataType: ads'
        }
    });
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__4e7850be._.js.map